{% assign current_lang = page.lang | default: site.default_lang %}
{% assign t = site.data.translations[current_lang] %}
{% assign visible_posts = site.articles | where_exp: "post", "post.hidden != true" %}

<div class="mt-10 grid gap-10 lg:grid-cols-[minmax(0,1fr)_240px]">
  <div>
    <div class="mb-10">
      <p class="text-xs uppercase text-slate-400 dark:text-slate-500">{{ t.categories.browse_by }}</p>
      <h1 class="mt-3 text-4xl font-semibold leading-tight md:text-[2.75rem]">{{ t.categories.title }}</h1>
      {% assign categories = visible_posts | map: "category" | compact | uniq %}
      <p class="mt-4 text-base text-slate-500 dark:text-slate-400">{{ categories.size }} {{ t.categories.plural }} {{ t.common.across_all }}</p>
    </div>

    <section class="grid gap-4 sm:grid-cols-2">
      {% assign categories = visible_posts | map: "category" | compact | uniq | sort %}
      {% for category in categories %}
      {% assign count = visible_posts | where: "category", category | size %}
      {% assign latest_post = visible_posts | where: "category", category | sort: "date" | reverse | first %}
      <a href="{{ lang_prefix | append: '/categories/' | append: category | downcase | append: '/' | relative_url }}"
         class="group rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-800/50 p-6 transition hover:border-[#fc4d50] hover:shadow-lg">
        <div class="flex items-start justify-between">
          <div>
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100 group-hover:text-[#fc4d50] transition-colors">
              {{ category }}
            </h2>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">{{ count }} {{ t.common.post_plural }}</p>
          </div>
          <span class="rounded-full bg-slate-100 dark:bg-slate-700 p-2 text-slate-400 dark:text-slate-500 group-hover:bg-[#fc4d50] group-hover:text-white transition-colors">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </span>
        </div>
        {% if latest_post %}
        <p class="mt-4 text-xs text-slate-400 dark:text-slate-500">
          {{ t.categories.latest }}: {{ latest_post.title | truncate: 40 }}
        </p>
        {% endif %}
      </a>
      {% endfor %}
    </section>

    <section class="mt-12 flex flex-col gap-4 border-t border-slate-200 dark:border-slate-800 pt-6 text-sm text-slate-500 dark:text-slate-400 md:flex-row md:items-center md:justify-between">
      <a class="inline-flex items-center gap-2 font-semibold text-[#fc4d50]" href="{{ lang_prefix | append: '/' | relative_url }}">
        <span aria-hidden="true">&larr;</span> {{ t.post.back_to_all }}
      </a>
    </section>
  </div>

  {% include sidebar.html %}
</div>
